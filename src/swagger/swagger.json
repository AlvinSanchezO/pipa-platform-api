{
  "openapi": "3.0.0",
  "info": {
    "title": "Pipa Platform API",
    "version": "1.0.0",
    "description": "API para el monitoreo de agua y gestión de servicios de pipas."
  },
  "servers": [
    {
      "url": "http://localhost:3000",
      "description": "Servidor de Desarrollo"
    }
  ],
  "tags": [
    { "name": "Autenticación", "description": "Endpoints para registro y login." },
    { "name": "Usuarios", "description": "Endpoints para gestionar la información del usuario." },
    { "name": "Proveedores", "description": "Endpoints para interactuar con los proveedores." },
    { "name": "Reportes", "description": "Endpoints para los reportes de agua de la comunidad." },
    { "name": "Pedidos", "description": "Endpoints para gestionar los pedidos de servicio." }
  ],
  "paths": {
    "/api/auth/register": {
      "post": {
        "tags": ["Autenticación"],
        "summary": "Registra un nuevo usuario.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "nombre": { "type": "string", "example": "Juan Pérez" },
                  "email": { "type": "string", "example": "juan@correo.com" },
                  "contrasena": { "type": "string", "example": "password123" }
                }
              }
            }
          }
        },
        "responses": {
          "201": { "description": "Usuario registrado exitosamente." }
        }
      }
    },
    "/api/auth/login": {
      "post": {
        "tags": ["Autenticación"],
        "summary": "Inicia sesión para un usuario.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "email": { "type": "string", "example": "juan@correo.com" },
                  "contrasena": { "type": "string", "example": "password123" }
                }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Login exitoso, devuelve un token JWT." }
        }
      }
    },
    "/api/user/profile": {
      "get": {
        "tags": ["Usuarios"],
        "summary": "Obtiene el perfil del usuario autenticado.",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": { "description": "Perfil del usuario." },
          "401": { "description": "No autorizado." }
        }
      }
    },
    "/api/proveedores": {
      "get": {
        "tags": ["Proveedores"],
        "summary": "Obtiene la lista de todos los proveedores.",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": { "description": "Lista de proveedores." },
          "401": { "description": "No autorizado." }
        }
      }
    },
    "/api/reportes": {
      "post": {
        "tags": ["Reportes"],
        "summary": "Crea un nuevo reporte sobre el estado del agua.",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "estado": { "type": "string", "enum": ["con_agua", "sin_agua"], "example": "sin_agua" },
                  "colonia": { "type": "string", "example": "Zona Rio" }
                }
              }
            }
          }
        },
        "responses": {
          "201": { "description": "Reporte creado exitosamente." },
          "401": { "description": "No autorizado." }
        }
      }
    },
    "/api/pedidos": {
      "post": {
        "tags": ["Pedidos"],
        "summary": "Crea un nuevo pedido de servicio.",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "providerId": { "type": "integer", "example": 1 }
                }
              }
            }
          }
        },
        "responses": {
          "201": { "description": "Pedido creado exitosamente." },
          "401": { "description": "No autorizado." }
        }
      },
      "get": {
        "tags": ["Pedidos"],
        "summary": "Obtiene el historial de pedidos del usuario autenticado.",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": { "description": "Historial de pedidos." },
          "401": { "description": "No autorizado." }
        }
      }
    },
    "/api/pedidos/{pedidoId}/rate": {
      "patch": {
        "tags": ["Pedidos"],
        "summary": "Califica un pedido específico.",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          {
            "in": "path",
            "name": "pedidoId",
            "required": true,
            "schema": { "type": "integer" }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "calificacion": { "type": "integer", "minimum": 1, "maximum": 5, "example": 5 },
                  "comentario": { "type": "string", "example": "Excelente servicio." }
                }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Pedido calificado exitosamente." },
          "401": { "description": "No autorizado." },
          "404": { "description": "Pedido no encontrado." }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    }
  }
}